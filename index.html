<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyclone Driver Application</title>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #0a4d68;
            --primary-light: #05668d;
            --primary-dark: #083854;
            --accent: #f97316;
            --accent-light: #fb923c;
            --bg-main: #fafbfc;
            --bg-card: #ffffff;
            --text-dark: #1e293b;
            --text-medium: #475569;
            --text-light: #94a3b8;
            --border: #e2e8f0;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
        }

        body {
            font-family: 'DM Sans', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e9ecef 100%);
            color: var(--text-dark);
            line-height: 1.6;
            min-height: 100vh;
            padding: 2rem 1rem;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: var(--bg-card);
            border-radius: 16px;
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            animation: slideUp 0.6s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            padding: 3rem 2rem;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -10%;
            width: 300px;
            height: 300px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: float 8s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) translateX(0); }
            50% { transform: translateY(-20px) translateX(20px); }
        }

        .header h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 1rem;
            opacity: 0.95;
            position: relative;
            z-index: 1;
        }

        .form-content {
            padding: 2.5rem 2rem;
        }

        .section {
            margin-bottom: 2.5rem;
            animation: fadeIn 0.5s ease-out backwards;
        }

        .section:nth-child(1) { animation-delay: 0.1s; }
        .section:nth-child(2) { animation-delay: 0.2s; }
        .section:nth-child(3) { animation-delay: 0.3s; }
        .section:nth-child(4) { animation-delay: 0.4s; }
        .section:nth-child(5) { animation-delay: 0.5s; }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--primary-dark);
            margin-bottom: 1.25rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid var(--accent);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .section-title::before {
            content: '';
            width: 6px;
            height: 24px;
            background: var(--accent);
            border-radius: 3px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.25rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        label {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-medium);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        label .required {
            color: var(--accent);
        }

        input[type="text"],
        input[type="email"],
        input[type="tel"],
        input[type="date"],
        select,
        textarea {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-family: 'DM Sans', sans-serif;
            font-size: 0.9375rem;
            color: var(--text-dark);
            transition: all 0.2s ease;
            background: var(--bg-main);
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--primary);
            background: white;
            box-shadow: 0 0 0 3px rgba(10, 77, 104, 0.1);
        }

        select {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg width='12' height='8' viewBox='0 0 12 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1.5L6 6.5L11 1.5' stroke='%23475569' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            padding-right: 2.5rem;
        }

        .file-upload-wrapper {
            position: relative;
            margin-top: 0.5rem;
        }

        .file-upload-area {
            position: relative;
            border: 2px dashed var(--border);
            border-radius: 8px;
            background: var(--bg-main);
            transition: all 0.2s ease;
        }

        .file-upload-area.drag-over {
            border-color: var(--primary);
            background: rgba(10, 77, 104, 0.05);
        }

        .file-upload-label {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
            color: var(--text-medium);
        }

        .file-upload-label:hover {
            border-color: var(--primary);
            background: rgba(10, 77, 104, 0.05);
        }

        .file-upload-label svg {
            width: 24px;
            height: 24px;
            stroke: var(--primary);
        }

        .btn-camera {
            background: var(--accent);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.875rem;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            margin: 0 auto 1rem;
        }

        .btn-camera:hover {
            background: var(--accent-light);
            transform: translateY(-1px);
        }

        input[type="file"] {
            position: absolute;
            opacity: 0;
            pointer-events: none;
        }

        .file-preview {
            margin-top: 0.75rem;
            padding: 0.75rem;
            background: var(--bg-main);
            border-radius: 6px;
            display: none;
            align-items: center;
            justify-content: space-between;
            font-size: 0.875rem;
        }

        .file-preview.active {
            display: flex;
        }

        .file-preview-name {
            color: var(--text-medium);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8125rem;
        }

        .file-remove {
            background: none;
            border: none;
            color: var(--accent);
            cursor: pointer;
            font-weight: 600;
            padding: 0.25rem 0.5rem;
        }

        .dynamic-section {
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            background: var(--bg-main);
            position: relative;
        }

        .dynamic-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .dynamic-section-title {
            font-weight: 600;
            color: var(--primary-dark);
            font-size: 1rem;
        }

        .btn-remove {
            background: transparent;
            border: 2px solid var(--accent);
            color: var(--accent);
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.875rem;
            transition: all 0.2s ease;
        }

        .btn-remove:hover {
            background: var(--accent);
            color: white;
        }

        .btn-add {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.875rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9375rem;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            width: 100%;
            margin-top: 1rem;
        }

        .btn-add:hover {
            background: var(--primary-light);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-lookup {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.875rem;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            white-space: nowrap;
        }

        .btn-lookup:hover {
            background: var(--primary-light);
            transform: translateY(-1px);
        }

        .btn-lookup:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .company-suggestions {
            margin-top: 0.5rem;
            background: white;
            border: 2px solid var(--border);
            border-radius: 8px;
            box-shadow: var(--shadow-lg);
            max-height: 300px;
            overflow-y: auto;
            z-index: 10;
        }

        .address-suggestions {
            margin-top: 0.5rem;
            background: white;
            border: 2px solid var(--border);
            border-radius: 8px;
            box-shadow: var(--shadow-lg);
            max-height: 300px;
            overflow-y: auto;
            z-index: 10;
        }

        .address-suggestion-item {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .address-suggestion-item:last-child {
            border-bottom: none;
        }

        .address-suggestion-item:hover {
            background: var(--bg-main);
        }

        .address-suggestion-main {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.25rem;
        }

        .address-suggestion-detail {
            font-size: 0.875rem;
            color: var(--text-medium);
        }

        .address-verified {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.75rem;
            color: #10b981;
            margin-top: 0.25rem;
        }

        .company-suggestion-item {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .company-suggestion-item:last-child {
            border-bottom: none;
        }

        .company-suggestion-item:hover {
            background: var(--bg-main);
        }

        .company-suggestion-name {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.25rem;
        }

        .company-suggestion-address {
            font-size: 0.875rem;
            color: var(--text-medium);
            line-height: 1.4;
        }

        .company-suggestion-contact {
            font-size: 0.8125rem;
            color: var(--text-light);
            margin-top: 0.25rem;
        }

        .no-results {
            padding: 1rem;
            text-align: center;
            color: var(--text-light);
            font-size: 0.875rem;
        }

        .btn-submit {
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            font-size: 1rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            width: 100%;
            margin-top: 2rem;
            box-shadow: var(--shadow-md);
        }

        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(249, 115, 22, 0.3);
        }

        .btn-submit:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .info-text {
            font-size: 0.8125rem;
            color: var(--text-light);
            margin-top: 0.5rem;
            font-style: italic;
        }

        .employment-status {
            margin-top: 1rem;
            padding: 0.75rem 1rem;
            background: var(--bg-card);
            border-left: 4px solid var(--primary);
            border-radius: 4px;
            font-size: 0.875rem;
            color: var(--text-medium);
        }

        .employment-status strong {
            color: var(--primary-dark);
        }

        .success-message {
            position: fixed;
            top: 2rem;
            right: 2rem;
            background: #10b981;
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: var(--shadow-lg);
            display: none;
            align-items: center;
            gap: 0.75rem;
            animation: slideIn 0.3s ease-out;
            z-index: 1000;
        }

        .success-message.active {
            display: flex;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 1rem 0.5rem;
            }

            .header {
                padding: 2rem 1.5rem;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .form-content {
                padding: 1.5rem 1rem;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .success-message {
                top: 1rem;
                right: 1rem;
                left: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸš› Cyclone Driver Application</h1>
            <p>Cyclone Linehaul - Complete all required fields below</p>
        </div>

        <form id="applicationForm" class="form-content">
            <!-- Personal Information -->
            <div class="section">
                <div class="section-title">Personal Information</div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>First Name <span class="required">*</span></label>
                        <input type="text" name="firstName" required>
                    </div>
                    <div class="form-group">
                        <label>Middle Name</label>
                        <input type="text" name="middleName">
                    </div>
                    <div class="form-group">
                        <label>Last Name <span class="required">*</span></label>
                        <input type="text" name="lastName" required>
                    </div>
                    <div class="form-group">
                        <label>Date of Birth <span class="required">*</span></label>
                        <input type="date" name="dob" required>
                    </div>
                    <div class="form-group">
                        <label>Email <span class="required">*</span></label>
                        <input type="email" name="email" required>
                    </div>
                    <div class="form-group">
                        <label>Phone Number <span class="required">*</span></label>
                        <input type="tel" name="phone" required>
                    </div>
                    <div class="form-group">
                        <label>Social Security Number <span class="required">*</span></label>
                        <input type="text" name="ssn" required pattern="\d{3}-?\d{2}-?\d{4}" placeholder="XXX-XX-XXXX" maxlength="11">
                    </div>
                </div>
            </div>

            <!-- CDL Information -->
            <div class="section">
                <div class="section-title">CDL Information</div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>CDL State <span class="required">*</span></label>
                        <select name="cdlState" required id="cdlState">
                            <option value="">Select State</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>CDL Number <span class="required">*</span></label>
                        <input type="text" name="cdlNumber" required>
                    </div>
                    <div class="form-group">
                        <label>CDL Expiration Date <span class="required">*</span></label>
                        <input type="date" name="cdlExpiration" required>
                    </div>
                    <div class="form-group">
                        <label>Doubles Endorsement <span class="required">*</span></label>
                        <select name="doublesEndorsement" required>
                            <option value="">Select</option>
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Have you ever driven for FedEx? <span class="required">*</span></label>
                        <select name="drivenForFedex" id="drivenForFedex" required onchange="toggleFedexId()">
                            <option value="">Select</option>
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                    </div>
                    <div class="form-group" id="fedexIdGroup" style="display: none;">
                        <label>FedEx ID <span class="required">*</span></label>
                        <input type="text" name="fedexId" id="fedexId">
                    </div>
                </div>

                <div class="form-group full-width">
                    <label>Upload CDL Picture - FRONT <span class="required">*</span></label>
                    <div class="file-upload-wrapper">
                        <div class="file-upload-area" id="cdlPictureFrontArea" ondrop="handleDrop(event, 'cdlPictureFront')" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                            <label for="cdlPictureFront" class="file-upload-label">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12"/>
                                </svg>
                                <span>Click to upload or drag and drop CDL Front</span>
                                <span style="font-size: 0.875rem; color: var(--text-light); margin-top: 0.25rem;">Accepts: JPG, PNG, PDF</span>
                            </label>
                            <input type="file" id="cdlPictureFront" name="cdlPictureFront" accept="image/*,.pdf" required style="display: none;">
                            <button type="button" class="btn-camera" onclick="openCamera('cdlPictureFront')">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"></path>
                                    <circle cx="12" cy="13" r="4"></circle>
                                </svg>
                                Take Photo
                            </button>
                        </div>
                        <div class="file-preview" id="cdlPictureFrontPreview">
                            <span class="file-preview-name"></span>
                            <button type="button" class="file-remove" onclick="removeFile('cdlPictureFront')">Remove</button>
                        </div>
                    </div>
                </div>

                <div class="form-group full-width">
                    <label>Upload CDL Picture - BACK <span class="required">*</span></label>
                    <div class="file-upload-wrapper">
                        <div class="file-upload-area" id="cdlPictureBackArea" ondrop="handleDrop(event, 'cdlPictureBack')" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                            <label for="cdlPictureBack" class="file-upload-label">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12"/>
                                </svg>
                                <span>Click to upload or drag and drop CDL Back</span>
                                <span style="font-size: 0.875rem; color: var(--text-light); margin-top: 0.25rem;">Accepts: JPG, PNG, PDF</span>
                            </label>
                            <input type="file" id="cdlPictureBack" name="cdlPictureBack" accept="image/*,.pdf" required style="display: none;">
                            <button type="button" class="btn-camera" onclick="openCamera('cdlPictureBack')">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"></path>
                                    <circle cx="12" cy="13" r="4"></circle>
                                </svg>
                                Take Photo
                            </button>
                        </div>
                        <div class="file-preview" id="cdlPictureBackPreview">
                            <span class="file-preview-name"></span>
                            <button type="button" class="file-remove" onclick="removeFile('cdlPictureBack')">Remove</button>
                        </div>
                    </div>
                </div>

                <div class="form-group full-width">
                    <label>Upload Medical Card <span class="required">*</span></label>
                    <div class="file-upload-wrapper">
                        <div class="file-upload-area" id="medicalCardArea" ondrop="handleDrop(event, 'medicalCard')" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                            <label for="medicalCard" class="file-upload-label">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12"/>
                                </svg>
                                <span>Click to upload or drag and drop Medical Card</span>
                                <span style="font-size: 0.875rem; color: var(--text-light); margin-top: 0.25rem;">Accepts: JPG, PNG, PDF</span>
                            </label>
                            <input type="file" id="medicalCard" name="medicalCard" accept="image/*,.pdf" required style="display: none;">
                            <button type="button" class="btn-camera" onclick="openCamera('medicalCard')">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"></path>
                                    <circle cx="12" cy="13" r="4"></circle>
                                </svg>
                                Take Photo
                            </button>
                        </div>
                        <div class="file-preview" id="medicalCardPreview">
                            <span class="file-preview-name"></span>
                            <button type="button" class="file-remove" onclick="removeFile('medicalCard')">Remove</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Address History -->
            <div class="section">
                <div class="section-title">Address History (Last 10 Years)</div>
                <p class="info-text">Please provide your address history for the past 10 years. Dates and details can be approximate - fill in what you remember.</p>
                <div id="addressHistory"></div>
                <button type="button" class="btn-add" onclick="addAddress()">
                    <span>+</span> Add Address
                </button>
            </div>

            <!-- Employment History -->
            <div class="section">
                <div class="section-title">Employment History (Last 3 Years)</div>
                <p class="info-text">Provide employment history from the last 3 years. Dates and details can be approximate - submit with whatever information you have available.</p>
                <div id="employmentHistory"></div>
                <div class="employment-status" id="employmentStatus">
                    <strong>Total Experience:</strong> <span id="totalExperience">0 months</span>
                </div>
                <button type="button" class="btn-add" onclick="addEmployment()">
                    <span>+</span> Add Employment
                </button>
            </div>

            <button type="submit" class="btn-submit">
                <span>Submit Application</span>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M5 12h14M12 5l7 7-7 7"/>
                </svg>
            </button>
        </form>
    </div>

    <div class="success-message" id="successMessage">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 11.08V12a10 10 0 11-5.93-9.14"/>
            <path d="M22 4L12 14.01l-3-3"/>
        </svg>
        <span>Application submitted successfully!</span>
    </div>

    <script>
        // US States array
        const states = [
            'Alabama', 'Alaska', 'Arizona', 'Arkansas', 'California', 'Colorado', 'Connecticut',
            'Delaware', 'Florida', 'Georgia', 'Hawaii', 'Idaho', 'Illinois', 'Indiana', 'Iowa',
            'Kansas', 'Kentucky', 'Louisiana', 'Maine', 'Maryland', 'Massachusetts', 'Michigan',
            'Minnesota', 'Mississippi', 'Missouri', 'Montana', 'Nebraska', 'Nevada', 'New Hampshire',
            'New Jersey', 'New Mexico', 'New York', 'North Carolina', 'North Dakota', 'Ohio',
            'Oklahoma', 'Oregon', 'Pennsylvania', 'Rhode Island', 'South Carolina', 'South Dakota',
            'Tennessee', 'Texas', 'Utah', 'Vermont', 'Virginia', 'Washington', 'West Virginia',
            'Wisconsin', 'Wyoming'
        ];

        // Populate state dropdown
        const cdlStateSelect = document.getElementById('cdlState');
        states.forEach(state => {
            const option = document.createElement('option');
            option.value = state;
            option.textContent = state;
            cdlStateSelect.appendChild(option);
        });

        let addressCount = 0;
        let employmentCount = 0;

        // Calculate date 10 years ago
        const tenYearsAgo = new Date();
        tenYearsAgo.setFullYear(tenYearsAgo.getFullYear() - 10);

        // Calculate date 3 years ago
        const threeYearsAgo = new Date();
        threeYearsAgo.setFullYear(threeYearsAgo.getFullYear() - 3);

        function addAddress() {
            addressCount++;
            const addressDiv = document.createElement('div');
            addressDiv.className = 'dynamic-section';
            addressDiv.id = `address-${addressCount}`;
            addressDiv.innerHTML = `
                <div class="dynamic-section-header">
                    <div class="dynamic-section-title">Address #${addressCount}</div>
                    <button type="button" class="btn-remove" onclick="removeAddress(${addressCount})">Remove</button>
                </div>
                <div class="form-grid">
                    <div class="form-group full-width">
                        <label>Street Address <span class="required">*</span></label>
                        <div style="display: flex; gap: 0.5rem;">
                            <input type="text" name="address[${addressCount}][street]" id="address-street-${addressCount}" required style="flex: 1;" placeholder="Start typing address..." oninput="autoSearchAddress(${addressCount})">
                            <button type="button" class="btn-lookup" onclick="verifyAddress(${addressCount})">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M9 11l3 3L22 4"></path>
                                    <path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"></path>
                                </svg>
                                Verify
                            </button>
                        </div>
                        <div class="address-suggestions" id="address-suggestions-${addressCount}" style="display: none;"></div>
                    </div>
                    <div class="form-group">
                        <label>City</label>
                        <input type="text" name="address[${addressCount}][city]" id="address-city-${addressCount}" oninput="autoSearchAddress(${addressCount})">
                    </div>
                    <div class="form-group">
                        <label>State</label>
                        <select name="address[${addressCount}][state]" id="address-state-${addressCount}" onchange="autoSearchAddress(${addressCount})">
                            <option value="">Select State</option>
                            ${states.map(state => `<option value="${state}">${state}</option>`).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ZIP Code</label>
                        <input type="text" name="address[${addressCount}][zip]" id="address-zip-${addressCount}" pattern="\\d{5}">
                    </div>
                    <div class="form-group">
                        <label>From Date</label>
                        <input type="date" name="address[${addressCount}][fromDate]" max="${new Date().toISOString().split('T')[0]}" min="${tenYearsAgo.toISOString().split('T')[0]}">
                    </div>
                    <div class="form-group">
                        <label>To Date</label>
                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                            <input type="date" name="address[${addressCount}][toDate]" id="address-toDate-${addressCount}" max="${new Date().toISOString().split('T')[0]}">
                            <label style="display: flex; align-items: center; gap: 0.25rem; margin: 0; white-space: nowrap; font-weight: 400;">
                                <input type="checkbox" id="address-present-${addressCount}" onchange="togglePresentAddress(${addressCount})">
                                <span style="font-size: 0.875rem;">To Present</span>
                            </label>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('addressHistory').appendChild(addressDiv);
            setupAddressAutocomplete(addressCount);
        }

        function removeAddress(id) {
            document.getElementById(`address-${id}`).remove();
        }

        function addEmployment() {
            employmentCount++;
            const employmentDiv = document.createElement('div');
            employmentDiv.className = 'dynamic-section';
            employmentDiv.id = `employment-${employmentCount}`;
            employmentDiv.innerHTML = `
                <div class="dynamic-section-header">
                    <div class="dynamic-section-title">Employment #${employmentCount}</div>
                    <button type="button" class="btn-remove" onclick="removeEmployment(${employmentCount})">Remove</button>
                </div>
                <div class="form-grid">
                    <div class="form-group full-width">
                        <label>Company Name <span class="required">*</span></label>
                        <div style="display: flex; gap: 0.5rem;">
                            <input type="text" name="employment[${employmentCount}][company]" id="employment-company-${employmentCount}" required style="flex: 1;" oninput="autoSearchCompany(${employmentCount})">
                            <button type="button" class="btn-lookup" onclick="lookupCompany(${employmentCount})">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="11" cy="11" r="8"></circle>
                                    <path d="M21 21l-4.35-4.35"></path>
                                </svg>
                                Lookup
                            </button>
                        </div>
                        <div class="company-suggestions" id="company-suggestions-${employmentCount}" style="display: none;"></div>
                    </div>
                    <div class="form-group full-width">
                        <label>Position/Title</label>
                        <input type="text" name="employment[${employmentCount}][position]">
                    </div>
                    <div class="form-group full-width">
                        <label>Company Address</label>
                        <input type="text" name="employment[${employmentCount}][address]" id="employment-address-${employmentCount}">
                    </div>
                    <div class="form-group">
                        <label>City</label>
                        <input type="text" name="employment[${employmentCount}][city]" id="employment-city-${employmentCount}" oninput="autoSearchCompanyByLocation(${employmentCount})">
                    </div>
                    <div class="form-group">
                        <label>State</label>
                        <select name="employment[${employmentCount}][state]" id="employment-state-${employmentCount}" onchange="autoSearchCompanyByLocation(${employmentCount})">
                            <option value="">Select State</option>
                            ${states.map(state => `<option value="${state}">${state}</option>`).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ZIP Code</label>
                        <input type="text" name="employment[${employmentCount}][zip]" id="employment-zip-${employmentCount}" pattern="\\d{5}">
                    </div>
                    <div class="form-group">
                        <label>Company Phone</label>
                        <input type="tel" name="employment[${employmentCount}][phone]" id="employment-phone-${employmentCount}">
                    </div>
                    <div class="form-group">
                        <label>Company Email</label>
                        <input type="email" name="employment[${employmentCount}][email]" id="employment-email-${employmentCount}">
                    </div>
                    <div class="form-group">
                        <label>From Date</label>
                        <input type="date" name="employment[${employmentCount}][fromDate]" max="${new Date().toISOString().split('T')[0]}" min="${threeYearsAgo.toISOString().split('T')[0]}" onchange="calculateTotalExperience()">
                    </div>
                    <div class="form-group">
                        <label>To Date</label>
                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                            <input type="date" name="employment[${employmentCount}][toDate]" id="employment-toDate-${employmentCount}" max="${new Date().toISOString().split('T')[0]}" onchange="calculateTotalExperience()">
                            <label style="display: flex; align-items: center; gap: 0.25rem; margin: 0; white-space: nowrap; font-weight: 400;">
                                <input type="checkbox" id="employment-present-${employmentCount}" onchange="togglePresentEmployment(${employmentCount})">
                                <span style="font-size: 0.875rem;">To Present</span>
                            </label>
                        </div>
                    </div>
                    <div class="form-group full-width">
                        <label>Reason for Leaving</label>
                        <input type="text" name="employment[${employmentCount}][reason]">
                    </div>
                </div>
            `;
            document.getElementById('employmentHistory').appendChild(employmentDiv);
        }

        function removeEmployment(id) {
            document.getElementById(`employment-${id}`).remove();
            calculateTotalExperience();
        }

        function calculateTotalExperience() {
            let totalMonths = 0;
            const employmentSections = document.querySelectorAll('[id^="employment-"]');
            
            employmentSections.forEach(section => {
                const fromDateInput = section.querySelector('input[name$="[fromDate]"]');
                const toDateInput = section.querySelector('input[name$="[toDate]"]');
                
                if (fromDateInput && toDateInput && fromDateInput.value && toDateInput.value) {
                    const fromDate = new Date(fromDateInput.value);
                    const toDate = new Date(toDateInput.value);
                    const months = (toDate.getFullYear() - fromDate.getFullYear()) * 12 + (toDate.getMonth() - fromDate.getMonth());
                    totalMonths += months;
                }
            });

            const years = Math.floor(totalMonths / 12);
            const months = totalMonths % 12;
            let displayText = '';
            
            if (years > 0) {
                displayText += `${years} year${years > 1 ? 's' : ''}`;
            }
            if (months > 0) {
                if (years > 0) displayText += ' ';
                displayText += `${months} month${months > 1 ? 's' : ''}`;
            }
            if (totalMonths === 0) {
                displayText = '0 months';
            }

            document.getElementById('totalExperience').textContent = displayText;

            // Check if they've reached 1 year (12 months)
            const statusDiv = document.getElementById('employmentStatus');
            if (totalMonths >= 12) {
                statusDiv.style.borderColor = '#10b981';
                statusDiv.innerHTML = `<strong>âœ“ Total Experience:</strong> ${displayText} (Requirement met!)`;
            } else {
                statusDiv.style.borderColor = 'var(--primary)';
                statusDiv.innerHTML = `<strong>Total Experience:</strong> ${displayText} (Need ${12 - totalMonths} more months to reach 1 year)`;
            }
        }

        // File upload handling
        function setupFileUpload(inputId) {
            const input = document.getElementById(inputId);
            const preview = document.getElementById(inputId + 'Preview');
            const previewName = preview.querySelector('.file-preview-name');

            input.addEventListener('change', function() {
                if (this.files && this.files[0]) {
                    previewName.textContent = this.files[0].name;
                    preview.classList.add('active');
                }
            });
        }

        function removeFile(inputId) {
            const input = document.getElementById(inputId);
            const preview = document.getElementById(inputId + 'Preview');
            input.value = '';
            preview.classList.remove('active');
        }

        // Drag and drop handlers
        function handleDragOver(event) {
            event.preventDefault();
            event.stopPropagation();
            event.currentTarget.classList.add('drag-over');
        }

        function handleDragLeave(event) {
            event.preventDefault();
            event.stopPropagation();
            event.currentTarget.classList.remove('drag-over');
        }

        function handleDrop(event, inputId) {
            event.preventDefault();
            event.stopPropagation();
            event.currentTarget.classList.remove('drag-over');

            const files = event.dataTransfer.files;
            if (files.length > 0) {
                const input = document.getElementById(inputId);
                input.files = files;
                
                // Trigger change event to update preview
                const changeEvent = new Event('change', { bubbles: true });
                input.dispatchEvent(changeEvent);
            }
        }

        // Camera functionality
        function openCamera(inputId) {
            // Check if device supports camera
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                alert('Camera not supported on this device. Please use file upload instead.');
                return;
            }

            // Create modal for camera
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.9);
                z-index: 10000;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                gap: 1rem;
            `;

            const video = document.createElement('video');
            video.style.cssText = `
                max-width: 90%;
                max-height: 70vh;
                border-radius: 8px;
            `;
            video.autoplay = true;
            video.playsInline = true;

            const canvas = document.createElement('canvas');
            canvas.style.display = 'none';

            const controls = document.createElement('div');
            controls.style.cssText = `
                display: flex;
                gap: 1rem;
            `;

            const captureBtn = document.createElement('button');
            captureBtn.textContent = 'ðŸ“¸ Capture Photo';
            captureBtn.type = 'button';
            captureBtn.style.cssText = `
                background: var(--accent);
                color: white;
                border: none;
                padding: 1rem 2rem;
                border-radius: 8px;
                font-weight: 600;
                font-size: 1rem;
                cursor: pointer;
            `;

            const closeBtn = document.createElement('button');
            closeBtn.textContent = 'âœ• Close';
            closeBtn.type = 'button';
            closeBtn.style.cssText = `
                background: var(--text-medium);
                color: white;
                border: none;
                padding: 1rem 2rem;
                border-radius: 8px;
                font-weight: 600;
                font-size: 1rem;
                cursor: pointer;
            `;

            controls.appendChild(captureBtn);
            controls.appendChild(closeBtn);
            modal.appendChild(video);
            modal.appendChild(controls);
            modal.appendChild(canvas);
            document.body.appendChild(modal);

            let stream;

            // Start camera
            navigator.mediaDevices.getUserMedia({ 
                video: { 
                    facingMode: 'environment',
                    width: { ideal: 1920 },
                    height: { ideal: 1080 }
                } 
            })
            .then(mediaStream => {
                stream = mediaStream;
                video.srcObject = stream;
            })
            .catch(error => {
                console.error('Camera error:', error);
                alert('Could not access camera: ' + error.message);
                document.body.removeChild(modal);
            });

            // Capture photo
            captureBtn.onclick = () => {
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                canvas.getContext('2d').drawImage(video, 0, 0);
                
                canvas.toBlob(blob => {
                    const file = new File([blob], `${inputId}_${Date.now()}.jpg`, { type: 'image/jpeg' });
                    const dataTransfer = new DataTransfer();
                    dataTransfer.items.add(file);
                    
                    const input = document.getElementById(inputId);
                    input.files = dataTransfer.files;
                    
                    // Trigger change event
                    const changeEvent = new Event('change', { bubbles: true });
                    input.dispatchEvent(changeEvent);
                    
                    // Close modal
                    if (stream) {
                        stream.getTracks().forEach(track => track.stop());
                    }
                    document.body.removeChild(modal);
                }, 'image/jpeg', 0.9);
            };

            // Close modal
            closeBtn.onclick = () => {
                if (stream) {
                    stream.getTracks().forEach(track => track.stop());
                }
                document.body.removeChild(modal);
            };
        }

        setupFileUpload('cdlPictureFront');
        setupFileUpload('cdlPictureBack');
        setupFileUpload('medicalCard');

        // Auto-search debounce timers
        const searchTimers = {};

        // Auto-search for home addresses as user types
        function autoSearchAddress(addressId) {
            clearTimeout(searchTimers[`address-${addressId}`]);
            
            searchTimers[`address-${addressId}`] = setTimeout(() => {
                const streetInput = document.getElementById(`address-street-${addressId}`);
                const cityInput = document.getElementById(`address-city-${addressId}`);
                const stateSelect = document.getElementById(`address-state-${addressId}`);
                
                const street = streetInput.value.trim();
                const city = cityInput.value.trim();
                const state = stateSelect.value;
                
                // Need at least city OR street to search
                if ((city && city.length >= 3) || (street && street.length >= 5)) {
                    performAddressAutoSearch(addressId, street, city, state);
                }
            }, 500); // Wait 500ms after user stops typing
        }

        async function performAddressAutoSearch(addressId, street, city, state) {
            const suggestionsDiv = document.getElementById(`address-suggestions-${addressId}`);
            
            try {
                // In production, use Google Places Autocomplete API
                // const response = await fetch(`https://maps.googleapis.com/maps/api/place/autocomplete/json?input=${encodeURIComponent(fullQuery)}&types=address&key=YOUR_GOOGLE_API_KEY`);
                
                // Simulated auto-search results
                const mockResults = generateAddressAutoSearchResults(street, city, state);
                
                if (mockResults.length > 0) {
                    displayAddressSuggestions(addressId, mockResults);
                }
            } catch (error) {
                console.error('Error in address auto-search:', error);
            }
        }

        function generateAddressAutoSearchResults(street, city, state) {
            // Simulates auto-complete results from Google Places API
            const results = [];
            
            if (city && state) {
                results.push({
                    street: street || '123 Main Street',
                    city: city,
                    state: state,
                    zip: '15106',
                    verified: true,
                    formatted: `${street || '123 Main Street'}, ${city}, ${state} 15106`
                });
                
                results.push({
                    street: street || '456 Oak Avenue',
                    city: city,
                    state: state,
                    zip: '15220',
                    verified: true,
                    formatted: `${street || '456 Oak Avenue'}, ${city}, ${state} 15220`
                });
            }
            
            return results;
        }

        // Auto-search for companies as user types
        function autoSearchCompany(employmentId) {
            clearTimeout(searchTimers[`company-${employmentId}`]);
            
            searchTimers[`company-${employmentId}`] = setTimeout(() => {
                const companyInput = document.getElementById(`employment-company-${employmentId}`);
                const companyName = companyInput.value.trim();
                
                if (companyName.length >= 3) {
                    performCompanyAutoSearch(employmentId, companyName, '', '');
                }
            }, 500);
        }

        // Auto-search for companies by location (city + state + company name if available)
        function autoSearchCompanyByLocation(employmentId) {
            clearTimeout(searchTimers[`company-location-${employmentId}`]);
            
            searchTimers[`company-location-${employmentId}`] = setTimeout(() => {
                const companyInput = document.getElementById(`employment-company-${employmentId}`);
                const cityInput = document.getElementById(`employment-city-${employmentId}`);
                const stateSelect = document.getElementById(`employment-state-${employmentId}`);
                
                const companyName = companyInput.value.trim();
                const city = cityInput.value.trim();
                const state = stateSelect.value;
                
                // Search if we have company name and location, or just location with 3+ chars
                if ((companyName && city) || (city && city.length >= 3 && state)) {
                    performCompanyAutoSearch(employmentId, companyName, city, state);
                }
            }, 500);
        }

        async function performCompanyAutoSearch(employmentId, companyName, city, state) {
            const suggestionsDiv = document.getElementById(`company-suggestions-${employmentId}`);
            
            try {
                // In production, use Google Places API
                // Build query based on what we have
                let query = companyName;
                if (city) query += ` ${city}`;
                if (state) query += ` ${state}`;
                
                // const response = await fetch(`https://maps.googleapis.com/maps/api/place/textsearch/json?query=${encodeURIComponent(query)}&key=YOUR_GOOGLE_API_KEY`);
                
                // Simulated auto-search results
                const mockResults = await generateCompanyAutoSearchResults(companyName, city, state);
                
                if (mockResults.length > 0) {
                    displayCompanySuggestions(employmentId, mockResults);
                }
            } catch (error) {
                console.error('Error in company auto-search:', error);
            }
        }

        async function generateCompanyAutoSearchResults(companyName, city, state) {
            // Simulates searching the internet for company matches
            const results = [];
            const baseName = companyName || 'ABC Company';
            const baseCity = city || 'Pittsburgh';
            const baseState = state || 'Pennsylvania';
            
            results.push({
                name: baseName,
                address: '1234 Business Drive',
                city: baseCity,
                state: baseState,
                zip: '15106',
                phone: '(412) 555-0100',
                email: `info@${baseName.toLowerCase().replace(/\s+/g, '')}.com`,
                source: 'Google Business'
            });
            
            if (companyName) {
                results.push({
                    name: `${baseName} LLC`,
                    address: '5678 Industrial Parkway',
                    city: baseCity,
                    state: baseState,
                    zip: '15220',
                    phone: '(412) 555-0200',
                    email: `contact@${baseName.toLowerCase().replace(/\s+/g, '')}llc.com`,
                    source: 'Business Directory'
                });
            }
            
            return results;
        }

        // Toggle "To Present" for addresses
        function togglePresentAddress(addressId) {
            const checkbox = document.getElementById(`address-present-${addressId}`);
            const toDateInput = document.getElementById(`address-toDate-${addressId}`);
            
            if (checkbox.checked) {
                toDateInput.value = new Date().toISOString().split('T')[0];
                toDateInput.disabled = true;
                toDateInput.style.opacity = '0.6';
            } else {
                toDateInput.disabled = false;
                toDateInput.style.opacity = '1';
            }
        }

        // Toggle "To Present" for employment
        function togglePresentEmployment(employmentId) {
            const checkbox = document.getElementById(`employment-present-${employmentId}`);
            const toDateInput = document.getElementById(`employment-toDate-${employmentId}`);
            
            if (checkbox.checked) {
                toDateInput.value = new Date().toISOString().split('T')[0];
                toDateInput.disabled = true;
                toDateInput.style.opacity = '0.6';
            } else {
                toDateInput.disabled = false;
                toDateInput.style.opacity = '1';
            }
            
            // Recalculate total experience
            calculateTotalExperience();
        }

        // Toggle FedEx ID field visibility
        function toggleFedexId() {
            const drivenForFedex = document.getElementById('drivenForFedex').value;
            const fedexIdGroup = document.getElementById('fedexIdGroup');
            const fedexIdInput = document.getElementById('fedexId');
            
            if (drivenForFedex === 'Yes') {
                fedexIdGroup.style.display = 'flex';
                fedexIdInput.required = true;
            } else {
                fedexIdGroup.style.display = 'none';
                fedexIdInput.required = false;
                fedexIdInput.value = '';
            }
        }

        // Company Lookup Function - Enhanced with internet search
        async function lookupCompany(employmentId) {
            const companyInput = document.getElementById(`employment-company-${employmentId}`);
            const companyName = companyInput.value.trim();
            const suggestionsDiv = document.getElementById(`company-suggestions-${employmentId}`);
            
            if (!companyName) {
                alert('Please enter a company name first');
                return;
            }

            const lookupBtn = event.target.closest('.btn-lookup');
            lookupBtn.disabled = true;
            lookupBtn.innerHTML = '<span>Searching...</span>';

            try {
                // Search the internet for company information
                // This uses Google Places API + supplementary searches for complete info
                
                // Method 1: Try Google Places API first (most reliable for address/phone)
                // const placesResponse = await fetch(`https://maps.googleapis.com/maps/api/place/textsearch/json?query=${encodeURIComponent(companyName)}&key=YOUR_GOOGLE_API_KEY`);
                
                // Method 2: Can also use business directory APIs like:
                // - Clearbit Company API
                // - Google Custom Search API
                // - OpenCorporates API
                
                // For demonstration, simulating a comprehensive internet search result
                setTimeout(async () => {
                    // Simulate fetching company data from multiple internet sources
                    const mockResults = await simulateInternetCompanySearch(companyName);
                    displayCompanySuggestions(employmentId, mockResults);
                    
                    lookupBtn.disabled = false;
                    lookupBtn.innerHTML = `
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="M21 21l-4.35-4.35"></path>
                        </svg>
                        Lookup
                    `;
                }, 1500);

            } catch (error) {
                console.error('Error looking up company:', error);
                suggestionsDiv.innerHTML = '<div class="no-results">Error searching for company. Please enter details manually.</div>';
                suggestionsDiv.style.display = 'block';
                lookupBtn.disabled = false;
                lookupBtn.innerHTML = `
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="M21 21l-4.35-4.35"></path>
                    </svg>
                    Lookup
                `;
            }
        }

        async function simulateInternetCompanySearch(companyName) {
            // This simulates searching the internet for company information
            // In production, this would aggregate data from:
            // 1. Google Places API (address, phone)
            // 2. Company website scraping (email, additional info)
            // 3. Business directories (LinkedIn, YellowPages, etc.)
            
            // Simulated results with realistic company data
            return [
                {
                    name: companyName,
                    address: '1234 Industrial Parkway',
                    city: 'Pittsburgh',
                    state: 'Pennsylvania',
                    zip: '15220',
                    phone: '(412) 555-0100',
                    email: `hr@${companyName.toLowerCase().replace(/\s+/g, '').replace(/[^a-z0-9]/g, '')}.com`,
                    source: 'Google Business Profile'
                },
                {
                    name: `${companyName} LLC`,
                    address: '5678 Commerce Drive',
                    city: 'Philadelphia',
                    state: 'Pennsylvania',
                    zip: '19103',
                    phone: '(215) 555-0200',
                    email: `contact@${companyName.toLowerCase().replace(/\s+/g, '')}.com`,
                    source: 'Business Directory'
                },
                {
                    name: `${companyName} Inc`,
                    address: '9012 Corporate Boulevard',
                    city: 'Harrisburg',
                    state: 'Pennsylvania',
                    zip: '17101',
                    phone: '(717) 555-0300',
                    email: '',
                    source: 'Company Website'
                }
            ];
        }

        function displayCompanySuggestions(employmentId, results) {
            const suggestionsDiv = document.getElementById(`company-suggestions-${employmentId}`);
            
            if (!results || results.length === 0) {
                suggestionsDiv.innerHTML = '<div class="no-results">No companies found. Please enter details manually.</div>';
                suggestionsDiv.style.display = 'block';
                return;
            }

            let html = '';
            results.forEach((company, index) => {
                html += `
                    <div class="company-suggestion-item" onclick="selectCompany(${employmentId}, ${index})">
                        <div class="company-suggestion-name">${company.name}</div>
                        <div class="company-suggestion-address">
                            ${company.address}<br>
                            ${company.city}, ${company.state} ${company.zip}
                        </div>
                        ${company.phone || company.email ? `
                            <div class="company-suggestion-contact">
                                ${company.phone ? company.phone : ''} 
                                ${company.phone && company.email ? ' â€¢ ' : ''}
                                ${company.email ? company.email : ''}
                            </div>
                        ` : ''}
                    </div>
                `;
            });

            suggestionsDiv.innerHTML = html;
            suggestionsDiv.style.display = 'block';
            
            // Store results for selection
            window[`companyResults_${employmentId}`] = results;
        }

        function selectCompany(employmentId, resultIndex) {
            const results = window[`companyResults_${employmentId}`];
            const company = results[resultIndex];
            
            // Fill in the form fields
            document.getElementById(`employment-company-${employmentId}`).value = company.name;
            document.getElementById(`employment-address-${employmentId}`).value = company.address;
            document.getElementById(`employment-city-${employmentId}`).value = company.city;
            document.getElementById(`employment-state-${employmentId}`).value = company.state;
            
            if (company.zip) {
                const zipField = document.getElementById(`employment-zip-${employmentId}`);
                if (zipField) zipField.value = company.zip;
            }
            
            if (company.phone) {
                const phoneField = document.getElementById(`employment-phone-${employmentId}`);
                if (phoneField) phoneField.value = company.phone;
            }
            
            if (company.email) {
                const emailField = document.getElementById(`employment-email-${employmentId}`);
                if (emailField) emailField.value = company.email;
            }
            
            // Hide suggestions
            document.getElementById(`company-suggestions-${employmentId}`).style.display = 'none';
        }

        // Close suggestions when clicking outside
        document.addEventListener('click', function(event) {
            if (!event.target.closest('.company-suggestions') && !event.target.closest('.btn-lookup')) {
                const allSuggestions = document.querySelectorAll('.company-suggestions');
                allSuggestions.forEach(div => div.style.display = 'none');
            }
            if (!event.target.closest('.address-suggestions') && !event.target.closest('.btn-lookup')) {
                const allAddressSuggestions = document.querySelectorAll('.address-suggestions');
                allAddressSuggestions.forEach(div => div.style.display = 'none');
            }
        });

        // Address Lookup and Verification Functions
        async function verifyAddress(addressId) {
            const streetInput = document.getElementById(`address-street-${addressId}`);
            const cityInput = document.getElementById(`address-city-${addressId}`);
            const stateSelect = document.getElementById(`address-state-${addressId}`);
            const zipInput = document.getElementById(`address-zip-${addressId}`);
            const suggestionsDiv = document.getElementById(`address-suggestions-${addressId}`);
            
            const street = streetInput.value.trim();
            const city = cityInput.value.trim();
            const state = stateSelect.value;
            const zip = zipInput.value.trim();
            
            if (!street) {
                alert('Please enter a street address first');
                return;
            }

            const verifyBtn = event.target.closest('.btn-lookup');
            verifyBtn.disabled = true;
            verifyBtn.innerHTML = '<span>Verifying...</span>';

            try {
                // Construct full address for verification
                let fullAddress = street;
                if (city) fullAddress += `, ${city}`;
                if (state) fullAddress += `, ${state}`;
                if (zip) fullAddress += ` ${zip}`;

                // Using Google Geocoding API for address verification
                // Note: You'll need to add your Google API key for this to work in production
                // const response = await fetch(`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(fullAddress)}&key=YOUR_GOOGLE_API_KEY`);
                
                // For demonstration, we'll simulate results
                setTimeout(() => {
                    // Simulated address verification results
                    const mockResults = generateAddressSuggestions(street, city, state, zip);
                    displayAddressSuggestions(addressId, mockResults);
                    
                    verifyBtn.disabled = false;
                    verifyBtn.innerHTML = `
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 11l3 3L22 4"></path>
                            <path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"></path>
                        </svg>
                        Verify
                    `;
                }, 1000);

            } catch (error) {
                console.error('Error verifying address:', error);
                suggestionsDiv.innerHTML = '<div class="no-results">Error verifying address. Please check your entry.</div>';
                suggestionsDiv.style.display = 'block';
                verifyBtn.disabled = false;
                verifyBtn.innerHTML = `
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 11l3 3L22 4"></path>
                        <path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"></path>
                    </svg>
                    Verify
                `;
            }
        }

        function generateAddressSuggestions(street, city, state, zip) {
            // This simulates address verification results
            // In production, this would come from Google Geocoding API or USPS API
            const baseStreet = street || '123 Main Street';
            const baseCity = city || 'Pittsburgh';
            const baseState = state || 'Pennsylvania';
            const baseZip = zip || '15106';

            return [
                {
                    street: baseStreet,
                    city: baseCity,
                    state: baseState,
                    zip: baseZip,
                    verified: true,
                    formatted: `${baseStreet}, ${baseCity}, ${baseState} ${baseZip}`
                },
                {
                    street: baseStreet.replace(/\b\w/g, l => l.toUpperCase()),
                    city: baseCity,
                    state: baseState,
                    zip: baseZip,
                    verified: true,
                    formatted: `${baseStreet.replace(/\b\w/g, l => l.toUpperCase())}, ${baseCity}, ${baseState} ${baseZip}`
                }
            ];
        }

        function displayAddressSuggestions(addressId, results) {
            const suggestionsDiv = document.getElementById(`address-suggestions-${addressId}`);
            
            if (!results || results.length === 0) {
                suggestionsDiv.innerHTML = '<div class="no-results">Address could not be verified. Please check your entry.</div>';
                suggestionsDiv.style.display = 'block';
                return;
            }

            let html = '';
            results.forEach((address, index) => {
                html += `
                    <div class="address-suggestion-item" onclick="selectAddress(${addressId}, ${index})">
                        <div class="address-suggestion-main">${address.street}</div>
                        <div class="address-suggestion-detail">${address.city}, ${address.state} ${address.zip}</div>
                        ${address.verified ? `
                            <div class="address-verified">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                                    <path d="M20 6L9 17l-5-5"></path>
                                </svg>
                                Verified Address
                            </div>
                        ` : ''}
                    </div>
                `;
            });

            suggestionsDiv.innerHTML = html;
            suggestionsDiv.style.display = 'block';
            
            // Store results for selection
            window[`addressResults_${addressId}`] = results;
        }

        function selectAddress(addressId, resultIndex) {
            const results = window[`addressResults_${addressId}`];
            const address = results[resultIndex];
            
            // Fill in the form fields with verified address
            document.getElementById(`address-street-${addressId}`).value = address.street;
            document.getElementById(`address-city-${addressId}`).value = address.city;
            document.getElementById(`address-state-${addressId}`).value = address.state;
            document.getElementById(`address-zip-${addressId}`).value = address.zip;
            
            // Hide suggestions
            document.getElementById(`address-suggestions-${addressId}`).style.display = 'none';
            
            // Add visual feedback that address is verified
            const streetInput = document.getElementById(`address-street-${addressId}`);
            streetInput.style.borderColor = '#10b981';
            setTimeout(() => {
                streetInput.style.borderColor = '';
            }, 2000);
        }

        // Add autocomplete for addresses as user types
        function setupAddressAutocomplete(addressId) {
            const streetInput = document.getElementById(`address-street-${addressId}`);
            let timeoutId;
            
            streetInput.addEventListener('input', function() {
                clearTimeout(timeoutId);
                const value = this.value.trim();
                
                if (value.length > 3) {
                    timeoutId = setTimeout(() => {
                        // In production, this would call Google Places Autocomplete API
                        // For now, we'll just show the verify button is available
                    }, 300);
                }
            });
        }

        // Initialize with one address and employment section
        addAddress();
        addEmployment();

        // Form submission - Open email client with pre-filled info
        document.getElementById('applicationForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const submitBtn = e.target.querySelector('.btn-submit');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span>Preparing Email...</span>';

            const formData = new FormData(this);
            
            // Collect all form data
            const applicationData = {
                personalInfo: {
                    firstName: formData.get('firstName'),
                    middleName: formData.get('middleName'),
                    lastName: formData.get('lastName'),
                    dob: formData.get('dob'),
                    email: formData.get('email'),
                    phone: formData.get('phone'),
                    ssn: formData.get('ssn')
                },
                cdlInfo: {
                    state: formData.get('cdlState'),
                    number: formData.get('cdlNumber'),
                    expiration: formData.get('cdlExpiration'),
                    doublesEndorsement: formData.get('doublesEndorsement'),
                    drivenForFedex: formData.get('drivenForFedex'),
                    fedexId: formData.get('fedexId') || 'N/A'
                },
                addresses: [],
                employment: []
            };

            // Collect addresses
            for (let i = 1; i <= addressCount; i++) {
                const street = formData.get(`address[${i}][street]`);
                if (street) {
                    applicationData.addresses.push({
                        street: street,
                        city: formData.get(`address[${i}][city]`) || '',
                        state: formData.get(`address[${i}][state]`) || '',
                        zip: formData.get(`address[${i}][zip]`) || '',
                        fromDate: formData.get(`address[${i}][fromDate]`) || '',
                        toDate: formData.get(`address[${i}][toDate]`) || ''
                    });
                }
            }

            // Collect employment
            for (let i = 1; i <= employmentCount; i++) {
                const company = formData.get(`employment[${i}][company]`);
                if (company) {
                    applicationData.employment.push({
                        company: company,
                        position: formData.get(`employment[${i}][position]`) || '',
                        address: formData.get(`employment[${i}][address]`) || '',
                        city: formData.get(`employment[${i}][city]`) || '',
                        state: formData.get(`employment[${i}][state]`) || '',
                        zip: formData.get(`employment[${i}][zip]`) || '',
                        phone: formData.get(`employment[${i}][phone]`) || '',
                        email: formData.get(`employment[${i}][email]`) || '',
                        fromDate: formData.get(`employment[${i}][fromDate]`) || '',
                        toDate: formData.get(`employment[${i}][toDate]`) || '',
                        reason: formData.get(`employment[${i}][reason]`) || ''
                    });
                }
            }

            // Create concise email body
            const emailBody = `NEW CDL DRIVER APPLICATION - CYCLONE LINEHAUL

APPLICANT: ${applicationData.personalInfo.firstName} ${applicationData.personalInfo.lastName}
DOB: ${applicationData.personalInfo.dob}
SSN: ${applicationData.personalInfo.ssn}
Email: ${applicationData.personalInfo.email}
Phone: ${applicationData.personalInfo.phone}

CDL: ${applicationData.cdlInfo.state} #${applicationData.cdlInfo.number}
Expires: ${applicationData.cdlInfo.expiration}
Doubles: ${applicationData.cdlInfo.doublesEndorsement}
FedEx: ${applicationData.cdlInfo.drivenForFedex} ${applicationData.cdlInfo.fedexId !== 'N/A' ? '(ID: ' + applicationData.cdlInfo.fedexId + ')' : ''}

ADDRESSES (${applicationData.addresses.length}):
${applicationData.addresses.map((addr, idx) => `${idx + 1}. ${addr.street}, ${addr.city} ${addr.state} ${addr.zip} (${addr.fromDate || '?'} to ${addr.toDate || '?'})`).join('\n')}

EMPLOYMENT (${applicationData.employment.length}):
${applicationData.employment.map((emp, idx) => `${idx + 1}. ${emp.company}${emp.position ? ' - ' + emp.position : ''} (${emp.fromDate || '?'} to ${emp.toDate || '?'})`).join('\n')}

**IMPORTANT: Please attach the 3 document files before sending:**
- CDL Front Picture
- CDL Back Picture  
- Medical Card

Full details available upon request.`;

            // Get file information for display
            const cdlFrontFile = formData.get('cdlPictureFront');
            const cdlBackFile = formData.get('cdlPictureBack');
            const medicalFile = formData.get('medicalCard');

            // Create mailto link
            const recipients = 'support@cspreources.com';
            const cc = 'JohnK@cyclonelinehaul.com,johnc@cyclonelinehaul.com';
            const subject = 'New Applicant for Cyclone for Processing';
            
            const mailtoLink = `mailto:${recipients}?cc=${cc}&subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(emailBody)}`;
            
            // Try to open email client
            try {
                window.location.href = mailtoLink;
                
                // Show instruction modal
                showAttachmentInstructions(cdlFrontFile.name, cdlBackFile.name, medicalFile.name);
                
            } catch (error) {
                console.error('Error opening email client:', error);
                alert('Could not open email client. Please ensure you have an email program installed (Outlook, Mail, etc.)');
            }
            
            // Re-enable button
            setTimeout(() => {
                submitBtn.disabled = false;
                submitBtn.innerHTML = `
                    <span>Submit Application</span>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M5 12h14M12 5l7 7-7 7"/>
                    </svg>
                `;
            }, 1000);
        });

        // Show instructions for attaching files
        function showAttachmentInstructions(file1, file2, file3) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 2rem;
            `;

            const content = document.createElement('div');
            content.style.cssText = `
                background: white;
                padding: 2rem;
                border-radius: 12px;
                max-width: 600px;
                width: 100%;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            `;

            content.innerHTML = `
                <h2 style="color: var(--primary-dark); margin-bottom: 1rem; font-size: 1.5rem;">
                    ðŸ“§ Email is Opening...
                </h2>
                <p style="margin-bottom: 1.5rem; line-height: 1.6; color: var(--text-medium);">
                    Your email client should open with a pre-filled application. 
                    <strong>Before sending, please attach these 3 files:</strong>
                </p>
                <div style="background: var(--bg-main); padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
                    <p style="margin: 0.5rem 0; font-family: 'JetBrains Mono', monospace; font-size: 0.875rem;">
                        âœ“ ${file1}
                    </p>
                    <p style="margin: 0.5rem 0; font-family: 'JetBrains Mono', monospace; font-size: 0.875rem;">
                        âœ“ ${file2}
                    </p>
                    <p style="margin: 0.5rem 0; font-family: 'JetBrains Mono', monospace; font-size: 0.875rem;">
                        âœ“ ${file3}
                    </p>
                </div>
                <p style="margin-bottom: 1.5rem; line-height: 1.6; color: var(--text-medium); font-size: 0.9rem;">
                    <strong>Tip:</strong> In your email, look for the "Attach" or ðŸ“Ž button, then browse to select the files you uploaded.
                </p>
                <button onclick="this.closest('div[style*=fixed]').remove()" style="
                    background: var(--primary);
                    color: white;
                    border: none;
                    padding: 0.75rem 1.5rem;
                    border-radius: 8px;
                    font-weight: 600;
                    cursor: pointer;
                    width: 100%;
                    font-size: 1rem;
                ">
                    Got It!
                </button>
            `;

            modal.appendChild(content);
            document.body.appendChild(modal);

            // Auto-close after 15 seconds
            setTimeout(() => {
                if (document.body.contains(modal)) {
                    modal.remove();
                }
            }, 15000);
        }

        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }
    </script>
</body>
</html>